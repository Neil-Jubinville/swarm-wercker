dev:
  box: python:2.7-slim
  steps:
    - pip-install
    - internal/watch:
        code: python server.py
        reload: true

build:
  box: python:2.7-slim
  steps:
    - pip-install
    - script:
        name: python unit test
        code: |
          python app_test.py
    - script:
        name: manually install flask
        code: pip install flask

    - script:
        name: copy binary
        code: cp -r entrypoint.sh static server.py "$WERCKER_OUTPUT_DIR"

deploy:
  box: python:2.7-slim
  steps:
    - internal/docker-push:
        username: kord 
        password: bazf00
        tag: latest
        cmd: pwd; ls
        ports: "5000"
        repository: registry.giantswarm.io/kord/swacker
        registry: https://registry.giantswarm.io

    - kordless/giantswarm:
        env: kord/prod
        token: 820f7077-b6b7-4e75-8afd-41dc4e59a98b
        update: swacker/swacker-service/flask
